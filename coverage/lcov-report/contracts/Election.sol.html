<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\Election.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Election.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">61.11% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>11/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">61.11% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>11/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">75% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>3/4</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">70.59% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>24/34</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">60×</span>
<span class="cline-any cline-yes">240×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.4;
&nbsp;
contract Election{
	uint8[3] val = [5, 3, 1];
	uint256 public endTime;
&nbsp;
	struct Voter {
		bool registered;
		bool[3][5] voted; // voter[N][0], voter[N][1], voter[N][2] // voter has voted in preference for that position
		uint8[3][5] vote; // vote[N][0], vote[N][1], vote[N][2]  // index of the candidates voted for
	}
&nbsp;
	struct Candidate {
		string name;
		uint16 votes; // number of votes the candidate has received
	}
&nbsp;
	address public leader;
&nbsp;
	mapping(address =&gt; Voter) public voters;
&nbsp;
	// mapping(uint8 =&gt; Candidate[]) public candidates; // index specifies the position the candidates are contesting for
	Candidate[][5] public candidates; // index specifies the position the candidates are contesting for
	// PSG, 4 gen secs - 5 positions total
	// candidates[0] =&gt; all candidates contesting for president
&nbsp;
	constructor(string[][5] memory _candidateNames, uint256 _endTime) {
		<span class="missing-if-branch" title="else path not taken" >E</span>require(
			block.timestamp &lt; _endTime, "End time must be in the future."
		);
&nbsp;
		leader = msg.sender;
		voters[leader].registered = true;
&nbsp;
		for(uint8 i = 0; i &lt; 5; i++){
			for(uint8 j = 0; j &lt; _candidateNames[i].length; j++){
				candidates[i].push(Candidate({name: _candidateNames[i][j], votes: 0}));
			}
		}
&nbsp;
		endTime = _endTime;
	}
&nbsp;
	function registerVoter(address voter) external {
		<span class="missing-if-branch" title="else path not taken" >E</span>require(block.timestamp &lt; endTime, "Election has ended.");
		require(
			msg.sender == leader,
			"Only the election leader can grant voting rights."
		);
		<span class="missing-if-branch" title="else path not taken" >E</span>require(!voters[voter].registered, "Voter is already registered.");
&nbsp;
		voters[voter].registered = true;
	}
&nbsp;
	function castVote(uint8 position, uint8 preference1, uint8 preference2, uint8 preference3) external {
		<span class="missing-if-branch" title="else path not taken" >E</span>require(block.timestamp &lt; endTime, "Election has ended.");
		require(
			voters[msg.sender].registered,
			"Only registered voters can vote."
		);
		require(
			!voters[msg.sender].voted[position][0],
			"You have already voted for this position."
		);
		<span class="missing-if-branch" title="else path not taken" >E</span>require(
			preference1 &lt; candidates[position].length &amp;&amp; preference2 &lt; candidates[position].length &amp;&amp; preference3 &lt; candidates[position].length,
			"Candidate does not exist."
		);
&nbsp;
		voters[msg.sender].voted[position][0] = true;
		voters[msg.sender].vote[position][0] = preference1;
		candidates[position][preference1].votes += val[0];
&nbsp;
        voters[msg.sender].voted[position][1] = true;
		voters[msg.sender].vote[position][1] = preference2;
		candidates[position][preference2].votes += val[1];
&nbsp;
        voters[msg.sender].voted[position][2] = true;
		voters[msg.sender].vote[position][2] = preference3;
		candidates[position][preference3].votes += val[2];
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function winningCandidatesName() external view returns(string[5] memory winnersName_){</span>
<span class="cstat-no" title="statement not covered" >        uint8[5] memory winners;</span>
<span class="cstat-no" title="statement not covered" >		for(uint8 position = 0; position &lt; 5; position++){</span>
<span class="cstat-no" title="statement not covered" >			int16 max = -1;</span>
<span class="cstat-no" title="statement not covered" >			for(uint8 i = 0; i &lt; candidates[position].length; i++){</span>
<span class="cstat-no" title="statement not covered" >				if(int16(candidates[position][i].votes) &gt; max){</span>
					max = int16(candidates[position][i].votes);
					winners[position] = i;
				}
			}
		}
<span class="cstat-no" title="statement not covered" >		for(uint8 position = 0; position &lt; 5; position++){</span>
			winnersName_[position] = candidates[position][winners[position]].name;
		}
&nbsp;
<span class="cstat-no" title="statement not covered" >		return winnersName_;</span>
	}
}
&nbsp;
/*
&nbsp;
1. allow only owner to register candidates
2. one candidate can be registered once only for entire elections
3. allow only owner to register voters
4. allow voter to vote only if registered
5. allow voter to vote only once 
6. do not allow voter to vote if any of the fields is empty
7. do not allow anyone to end the elections
8. allow everybody to view the results
9. can call 5/3/1 in that order
10. call each only once
&nbsp;
*/
&nbsp;
/*
TODO: 
1. Add support for voting for NOTA
*/</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Jul 29 2023 21:53:23 GMT+0530 (India Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
